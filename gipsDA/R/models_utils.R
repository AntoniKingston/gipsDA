# Helper: compute project a covariance / scatter matrix with gips
project_cov_MAP <- function(emp_cov, n_obs) {
    # build gips object from empirical covariance / scatter and n
    gg <- gips::gips(emp_cov, n_obs, was_mean_estimated = TRUE)
    # optimize to find MAP
    gg <- gips::find_MAP(gg, optimizer = "BF")
    perm <- gg[[1]]
    # project matrix onto invariants of cyclic group generated by perm
    gips::project_matrix(emp_cov, perm)
}

project_covs_MAP <- function(emp_covs, ns_obs) {
    gg <- gipsmult(emp_covs, ns_obs, was_mean_estimated = TRUE)
    gg <- find_MAP(gg, optimizer = "BF")
    perm <- gg[[1]]
    lapply(emp_covs, function(x) gips::project_matrix(x, perm))
}